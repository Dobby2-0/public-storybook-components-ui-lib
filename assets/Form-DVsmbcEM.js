import{r as o}from"./index-DRjF_FHU.js";import{j as R,b as g,r as T}from"./useFocusRing-D1qkr21P.js";const C={badInput:!1,customError:!1,patternMismatch:!1,rangeOverflow:!1,rangeUnderflow:!1,stepMismatch:!1,tooLong:!1,tooShort:!1,typeMismatch:!1,valueMissing:!1,valid:!0},D={...C,customError:!0,valid:!1},m={isInvalid:!1,validationDetails:C,validationErrors:[]},U=o.createContext({}),x="__formValidationState"+Date.now();function z(a){if(a[x]){let{realtimeValidation:e,displayValidation:t,updateValidation:l,resetValidation:u,commitValidation:d}=a[x];return{realtimeValidation:e,displayValidation:t,updateValidation:l,resetValidation:u,commitValidation:d}}return j(a)}function j(a){let{isInvalid:e,validationState:t,name:l,value:u,builtinValidation:d,validate:c,validationBehavior:v="aria"}=a;t&&(e||(e=t==="invalid"));let i=e!==void 0?{isInvalid:e,validationErrors:[],validationDetails:D}:null,n=o.useMemo(()=>{if(!c||u==null)return null;let r=F(c,u);return L(r)},[c,u]);d!=null&&d.validationDetails.valid&&(d=void 0);let s=o.useContext(U),f=o.useMemo(()=>l?Array.isArray(l)?l.flatMap(r=>I(s[r])):I(s[l]):[],[s,l]),[A,w]=o.useState(s),[M,V]=o.useState(!1);s!==A&&(w(s),V(!1));let b=o.useMemo(()=>L(M?[]:f),[M,f]),S=o.useRef(m),[p,E]=o.useState(m),$=o.useRef(m),O=()=>{if(!B)return;y(!1);let r=n||d||S.current;h(r,$.current)||($.current=r,E(r))},[B,y]=o.useState(!1);return o.useEffect(O),{realtimeValidation:i||b||n||d||m,displayValidation:v==="native"?i||b||p:i||b||n||d||p,updateValidation(r){v==="aria"&&!h(p,r)?E(r):S.current=r},resetValidation(){let r=m;h(r,$.current)||($.current=r,E(r)),v==="native"&&y(!1),V(!0)},commitValidation(){v==="native"&&y(!0),V(!0)}}}function I(a){return a?Array.isArray(a)?a:[a]:[]}function F(a,e){if(typeof a=="function"){let t=a(e);if(t&&typeof t!="boolean")return I(t)}return[]}function L(a){return a.length?{isInvalid:!0,validationErrors:a,validationDetails:D}:null}function h(a,e){return a===e?!0:!!a&&!!e&&a.isInvalid===e.isInvalid&&a.validationErrors.length===e.validationErrors.length&&a.validationErrors.every((t,l)=>t===e.validationErrors[l])&&Object.entries(a.validationDetails).every(([t,l])=>e.validationDetails[t]===l)}function G(a,e,t){let{validationBehavior:l,focus:u}=a;R(()=>{if(l==="native"&&(t!=null&&t.current)){let i=e.realtimeValidation.isInvalid?e.realtimeValidation.validationErrors.join(" ")||"Invalid value.":"";t.current.setCustomValidity(i),t.current.hasAttribute("title")||(t.current.title=""),e.realtimeValidation.isInvalid||e.updateValidation(_(t.current))}});let d=g(()=>{e.resetValidation()}),c=g(i=>{var n;e.displayValidation.isInvalid||e.commitValidation();let s=t==null||(n=t.current)===null||n===void 0?void 0:n.form;if(!i.defaultPrevented&&t&&s&&k(s)===t.current){var f;u?u():(f=t.current)===null||f===void 0||f.focus(),T("keyboard")}i.preventDefault()}),v=g(()=>{e.commitValidation()});o.useEffect(()=>{let i=t==null?void 0:t.current;if(!i)return;let n=i.form;return i.addEventListener("invalid",c),i.addEventListener("change",v),n==null||n.addEventListener("reset",d),()=>{i.removeEventListener("invalid",c),i.removeEventListener("change",v),n==null||n.removeEventListener("reset",d)}},[t,c,v,d,l])}function Q(a){let e=a.validity;return{badInput:e.badInput,customError:e.customError,patternMismatch:e.patternMismatch,rangeOverflow:e.rangeOverflow,rangeUnderflow:e.rangeUnderflow,stepMismatch:e.stepMismatch,tooLong:e.tooLong,tooShort:e.tooShort,typeMismatch:e.typeMismatch,valueMissing:e.valueMissing,valid:e.valid}}function _(a){return{isInvalid:!a.validity.valid,validationDetails:Q(a),validationErrors:a.validationMessage?[a.validationMessage]:[]}}function k(a){for(let e=0;e<a.elements.length;e++){let t=a.elements[e];if(!t.validity.valid)return t}return null}const H=o.createContext(null);export{z as $,G as a,H as b,x as c,m as d};
